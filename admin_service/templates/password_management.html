{% extends "base.html" %}

{% block title %}老師傅後台管理系統{% endblock %}

{% block content %}
<link rel="stylesheet" href="../static/css/styles.css">
<link rel="stylesheet" href="../static/css/password.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css">

<div class="container mt-5">
    <!-- 更改密碼的標題 -->
    <h2>綁定信箱驗證</h2>
    <p class="text-muted">您需要驗證已綁定的信箱，然後才能更改您的密碼。</p>

    <!-- 顯示當前綁定的信箱 -->
    <div class="mb-3">
        <label for="bound_email" class="form-label">目前綁定的信箱：</label>
        <input type="email" class="form-control" id="bound_email" value="user@example.com" readonly>
        <button type="button" id="sendVerificationEmailBtn" class="btn btn-primary mt-3">寄送驗證信</button>
    </div>

    <!-- 當前密碼輸入，默認隱藏 -->
    <div id="passwordSection" style="display: none;">
        <h2>更改密碼</h2>
        <p class="text-muted">於此處可更改此帳戶密碼，完成驗證操作後即可使用新密碼登入。</p>

        <!-- 步驟指示 -->
        <ul class="step-list">
            <li>1. 在上方輸入框內，輸入目前用於登入的密碼。</li>
            <li>2. 確認完畢後，於第二欄輸入欲更改的新密碼，點擊按鈕將會寄送一封驗證信到信箱中。</li>
            <li>3. 驗證成功後將自動登出，請使用新密碼登入。</li>
        </ul>

        <!-- 當前密碼 -->
        <form id="passwordForm">
            <div class="mb-3">
                <label for="current_password" class="form-label">當前密碼：</label>
                <input type="password" class="form-control" id="current_password" name="current_password" placeholder="請輸入當前的密碼" required>
                <button type="button" id="verifyCurrentPasswordBtn" class="btn btn-primary">進行驗證</button>
            </div>

            <!-- 新密碼 -->
            <div class="mb-3">
                <label for="new_password" class="form-label">輸入新密碼：</label>
                <input type="password" class="form-control" id="new_password" name="new_password" placeholder="請輸入您要更改的新密碼" required>
                <button type="button" id="verifyNewPasswordBtn" class="btn btn-primary">寄送驗證信</button>
            </div>

            <div id="loadingSpinner" class="text-center" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </form>

        <div id="resultMessage" class="mt-3"></div>
    </div>
</div>

<script src="../static/js/password_management.js"></script>
{% endblock %}